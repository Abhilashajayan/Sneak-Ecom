<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel='stylesheet' href='https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css'>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/owl-carousel/1.3.3/owl.carousel.min.css">    
    <link rel='stylesheet' href='https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css'>
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/owl-carousel/1.3.3/owl.carousel.min.css'>
    <link rel='stylesheet' href='https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
   <link rel="stylesheet" href="stylesheets/productSel.css">
   
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <title>Document</title>
</head>
<body>
    <%- include('../partials/navbar') %>


    <!-- <section class="mt-3 ml-3" >
        <div class="container-fluid">
            <img src="images/Content.png" alt="" class="img-fluid">
        </div>
        <!-- <div id="section-1" class="overlay-text col-6 col-md-6 col-lg-4 position-absolute justify-content-center top-0 ml-5  mt-5 start-3 p-4 text-dark">
            <h2 class="mt-5 ">Shop</h2>
            <p class="d-none d-sm-block mt-3">Keep your everyday style chic and on-trend with our selection 20+ styles to choose from.</p>
        </div> -->
        <section class="container mt-5 ">
            <div class=" position-relative">
                <img src="images/Content.png" alt="" class="img-fluid">
                <div id="section-1" class="overlay-text col-12 col-md-6 col-lg-4 position-absolute top-50 start-50 translate-middle p-4 text-dark d-flex flex-column align-items-center">
                    <h2 class="mt-5 text-center">Shop</h2>
                    <p class="d-block d-sm-none text-center mt-3 small-font-size">Keep your everyday style chic and on-trend with our selection 20+ styles to choose from.</p>
                    <p class="d-none d-sm-block mt-3">Keep your everyday style chic and on-trend with our selection 20+ styles to choose from.</p>
                </div>
            </div>
        </section>
        <!-- <section class="container section-with-shadow">
            <div class="row">
                <div class="col-md ">
                    <p class=" ">256 pages</p>
                </div>
                <div class="col-md " >
                    <a>Filter<i class="fa fa-filter"></i></a>
                </div>
                <div class="col-md ml-o " >
                    <a>Filter<i class="fa fa-filter"></i></a>
                </div>
                
            </div>
        </section> -->
        <section class="container bg-light d-flex justify-content-end align-content-center  py-3 " >
            <div class="searchBox mr-2">
                <input class="searchInput" type="text" name="" placeholder="Search">
                <button class="searchButton border-0 ">
                    <i class="fa fa-search" style="color: black;"></i>
                </button>
            </div>
            <div class="btn-group mr-2">
                <button class="btn  dropdown-toggle" type="button" style="background-color:#f1f1f1 ;" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Filter <i class="bi bi-filter"></i>
                </button>
              
                <div class="dropdown-menu ">
                    <form class="px-4 py-3" id="filterForm">
                        <% cartItems.forEach((user, index) => { %>
                            <div class="form-check">
                              <input class="form-check-input" type="radio" id="<%= 'filterOption' + index %>" name="category" value="<%= user.categoryName %>">
                              <label class="form-check-label" for="<%= 'filterOption' + index %>">
                                <%= user.categoryName %>
                              </label>
                            </div>
                          <% }) %>
                          
                    </form>
                </div>
            </div>
            <div class="btn-group">
                <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                  Sort
                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                    <li><a class="dropdown-item" href="#" data-sort="low-to-high">Low-To-High</a></li>
                    <li><a class="dropdown-item" href="#" data-sort="high-to-low">High-To-Low</a></li>
                </ul>
                
            </div>
                 
                  
        </section>
        
    <div class="container bg-white"   id="productContainer">
    
        <div class="row container-fluid">
            <% userData.forEach((user, index) => { %>
            <div class="col-lg-3 col-sm-6 d-flex c flex-column align-items-center justify-content-center product-item my-3">
                <div class="product"> <img src="<%= user.productImages[0].secure_url %>" alt="">
                    <ul class="d-flex align-items-center justify-content-center list-unstyled icons">
                        <li class="icon"><span class="fas fa-expand-arrows-alt"></span></li>
                        <li class="icon mx-3"><span class="far fa-heart"></span></li>
                        <li class="icon"><span class="fas fa-shopping-bag"></span></li>
                    </ul>
                </div>
                <% if (user.discount > 0) { %>
                <div class="tag bg-red"><%= user.discount %>%off</div>
                <% } %>
                <div class="title pt-4 pb-1"><a class="text-secondary" href="/product-Selection/<%= user._id %>" style="text-decoration: none;"><%= user.productTitle %></a></div>
                <div class="d-flex align-content-center justify-content-center"> <span class="fas fa-star"></span> <span class="fas fa-star"></span> <span class="fas fa-star"></span> <span class="fas fa-star"></span> <span class="fas fa-star"></span> </div>
                <div class="price">â‚¹ <%= user.productPrice %>.0</div>
            </div>
         <%})%>
        </div>
    </div>
    <div class="d-flex justify-content-center align-items-center">
        <a href="?page=<%= currentPage + 1 %>" class="btn btn-dark" id="loadMoreButton">Load More</a>
    </div>
     
    

   <%- include('../partials/footer') %>
   <script>
 
        const productContainer = document.getElementById('productContainer');
        const searchInput = document.querySelector('.searchInput');
        let selectedValue;
        searchInput.addEventListener('input', () => {
        const searchBox = document.querySelector('.searchBox');
           if (searchInput.value.trim() !== '') {
                searchBox.classList.add('expanded');
            } else {
        searchBox.classList.remove('expanded');
        }
        });
        document.addEventListener('DOMContentLoaded', () => {
    const radioButtons = document.querySelectorAll('input[type="radio"][name="category"]');
    
    radioButtons.forEach(radioButton => {
      radioButton.addEventListener('change', (event) => {
        if (event.target.checked) {
          selectedValue = event.target.value;
          console.log('Selected value:', selectedValue);
          sendDataToServer(selectedValue);
        }
      });
    });
  });


    searchInput.addEventListener('input', async function() {
    const inputValue = searchInput.value.trim();
    console.log(inputValue);
    });

    searchInput.addEventListener('keyup', async function(event) {
    if (searchInput.value) {
        const inputValue = searchInput.value.trim();
        
        try {
            const response = await fetch(`/SearchProduct/${encodeURIComponent(inputValue)}`);
            const data = await response.json();
            if (data.Datas && data.Datas.length > 0) {
                const row = productContainer.querySelector('.row');
                row.innerHTML = ''; // Clear existing products
                
                data.Datas.forEach(result => {
                    const productItem = document.createElement('div');
                    productItem.className = 'col-lg-3 col-sm-6 d-flex c flex-column align-items-center justify-content-center product-item my-3';
                    productItem.innerHTML = `
                        <!-- Your HTML structure for each product -->
                        <div class="product"> 
                            <img src="${result.productImages[0].secure_url}" alt="">
                            <ul class="d-flex align-items-center justify-content-center list-unstyled icons">
                                <li class="icon"><span class="fas fa-expand-arrows-alt"></span></li>
                                <li class="icon mx-3"><span class="far fa-heart"></span></li>
                                <li class="icon"><span class="fas fa-shopping-bag"></span></li>
                            </ul>
                        </div>
                        <div class="tag bg-red">Best Selling</div>
                        <div class="title pt-4 pb-1">${result.productTitle}</div>
                        <div class="d-flex align-content-center justify-content-center"> 
                            <span class="fas fa-star"></span> 
                            <span class="fas fa-star"></span> 
                            <span class="fas fa-star"></span> 
                            <span class="fas fa-star"></span> 
                            <span class="fas fa-star"></span>
                        </div>
                        <div class="price">$ ${result.productPrice}.0</div>
                    `;
                    
                    // Append the product item to the row
                    row.appendChild(productItem);
                });
            }
            
        } catch (error) {
            console.error("Fetch error:", error);
        }
    }
});


  async function sendDataToServer(selectedValue) {
                        try {
                            const response = await fetch(`/filterData`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({selectedValue})
                            });

                            if (response.ok) {
                                const data = await response.json();
                                if (data.Datas && data.Datas.length > 0) {
                                    const row = productContainer.querySelector('.row');
                                    row.innerHTML = ''; // Clear existing products

                                    data.Datas.forEach(result => {
                                        const productItem = document.createElement('div');
                                        productItem.className = 'col-lg-3 col-sm-6 d-flex c flex-column align-items-center justify-content-center product-item my-3';
                                        productItem.innerHTML = `
                                          <!-- Your HTML structure for each product -->
                                      <div class="product"> 
                                         <img src="${
                                            result.productImages[0].secure_url
                                        }" alt="">
                                         <ul class="d-flex align-items-center justify-content-center list-unstyled icons">
                                           <li class="icon"><span class="fas fa-expand-arrows-alt"></span></li>
                                           <li class="icon mx-3"><span class="far fa-heart"></span></li>
                                           <li class="icon"><span class="fas fa-shopping-bag"></span></li>
                                         </ul>
                                           </div>
                                             <div class="tag bg-red">Best Selling</div>
                                         <div class="title pt-4 pb-1">${
                                            result.productTitle
                                         }</div>
                                         <div class="d-flex align-content-center justify-content-center"> 
                                        <span class="fas fa-star"></span> 
                                      <span class="fas fa-star"></span> 
                                      <span class="fas fa-star"></span> 
                                     <span class="fas fa-star"></span> 
                                        <span class="fas fa-star"></span>
                                             </div>
                                  <div class="price">$ ${
                                            result.productPrice
                                        }.0</div>
                                             `;

                                        // Append the product item to the row
                                        row.appendChild(productItem);
                                    });
                                }

                            } else {
                                console.error('Failed to send data to server');
                            }
                        } catch (error) {
                            console.error('Fetch error:', error);
                        }
                    }


async function sendDataToServer(selectedValue) {
    try {
        const response = await fetch(`/filterProduct?sort=${selectedValue}`, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        });

        if (response.ok) {
            const data = await response.json();
            if (data.Datas && data.Datas.length > 0) {
                const row = productContainer.querySelector('.row');
                row.innerHTML = ''; // Clear existing products

                data.Datas.forEach(result => {
                    const productItem = document.createElement('div');
                    productItem.className = 'col-lg-3 col-sm-6 d-flex c flex-column align-items-center justify-content-center product-item my-3';
                    productItem.innerHTML = `
                        <!-- Your HTML structure for each product -->
                        <div class="product"> 
                            <img src="${result.productImages[0].secure_url}" alt="">
                            <ul class="d-flex align-items-center justify-content-center list-unstyled icons">
                                <li class="icon"><span class="fas fa-expand-arrows-alt"></span></li>
                                <li class="icon mx-3"><span class="far fa-heart"></span></li>
                                <li class="icon"><span class="fas fa-shopping-bag"></span></li>
                            </ul>
                        </div>
                        <div class="tag bg-red">Best Selling</div>
                        <div class="title pt-4 pb-1">${result.productTitle}</div>
                        <div class="d-flex align-content-center justify-content-center"> 
                            <span class="fas fa-star"></span> 
                            <span class="fas fa-star"></span> 
                            <span class="fas fa-star"></span> 
                            <span class="fas fa-star"></span> 
                            <span class="fas fa-star"></span>
                        </div>
                        <div class="price">$ ${result.productPrice}.0</div>
                    `;

                    // Append the product item to the row
                    row.appendChild(productItem);
                });
            }
        } else {
            console.error('Failed to send data to the server');
        }
    } catch (error) {
        console.error('Fetch error:', error);
    }
}

// Add event listeners to the dropdown items
const sortDropdownItems = document.querySelectorAll('.dropdown-item');
sortDropdownItems.forEach(item => {
    item.addEventListener('click', () => {
        const selectedValue = item.getAttribute('data-sort'); // Get the selected sort order
        sendDataToServer(selectedValue); // Fetch and display products based on the selected order
    });
});


document.addEventListener('DOMContentLoaded', function () {
    var dropdownToggleButtons = document.querySelectorAll('.dropdown-toggle');
    dropdownToggleButtons.forEach(function (button) {
        button.addEventListener('click', function () {
            var dropdown = this.nextElementSibling;
            if (dropdown.classList.contains('show')) {
                dropdown.classList.remove('show');
                this.setAttribute('aria-expanded', 'false');
            } else {
                dropdown.classList.add('show');
                this.setAttribute('aria-expanded', 'true');
            }
        });
    });
});



   </script>
  
</body>
</html>